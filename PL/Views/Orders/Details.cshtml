@model PL.ViewModels.Orders.OrderViewModel

@{
    ViewData["Title"] = $"Order Details #{Model.Id}";
}

<h1 class="mb-4">Order Details <small class="text-muted">#@Model.Id</small></h1>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-dark text-white">
        Order Information
    </div>
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-3">Order Date:</dt>
            <dd class="col-sm-9">@Model.OrderDate.ToString("yyyy-MM-dd hh:mm:ss tt")</dd>

            <dt class="col-sm-3">Status:</dt>
            <dd class="col-sm-9">
                <span class="badge @(Model.Status == DAL.Models.OrderStatus.Pending ? "bg-secondary" :
                                     Model.Status == DAL.Models.OrderStatus.Preparing ? "bg-info text-dark" :
                                     Model.Status == DAL.Models.OrderStatus.Ready ? "bg-success" :
                                     Model.Status == DAL.Models.OrderStatus.Delivered ? "bg-primary" : "bg-danger")">
                    @Model.Status
                </span>
            </dd>

            <dt class="col-sm-3">Order Type:</dt>
            <dd class="col-sm-9">@Model.Type</dd>

            @if (Model.Type == DAL.Models.OrderType.Delivery)
            {
                <dt class="col-sm-3">Delivery Address:</dt>
                <dd class="col-sm-9">@Model.DeliveryAddress</dd>
            }

            <dt class="col-sm-3">Total Amount:</dt>
            <dd class="col-sm-9"><strong>@Model.TotalAmount.ToString("C")</strong></dd>

            <dt class="col-sm-3">Discount:</dt>
            <dd class="col-sm-9">@Model.DiscountAmount.ToString("C")</dd>

            <dt class="col-sm-3">Tax:</dt>
            <dd class="col-sm-9">@Model.TaxAmount.ToString("C")</dd>
            @if (Model.EstimatedDeliveryTime.HasValue)
            {
                <dt class="col-sm-3">Estimated Delivery:</dt>
                <dd class="col-sm-9">@Model.EstimatedDeliveryTime.Value.ToString("yyyy-MM-dd hh:mm:ss tt")</dd>
            }
        </dl>
    </div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-dark text-white">
        Order Items
    </div>
    <div class="card-body">
        @if (Model.OrderItems != null && Model.OrderItems.Any())
        {
            <table class="table table-bordered table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Item Name</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OrderItems)
                    {
                        <tr>
                            <td>@item.MenuItemName</td>
                            <td>@item.Quantity</td>
                            <td>@item.UnitPrice.ToString("C")</td>
                            <td>@item.Subtotal.ToString("C")</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-warning mb-0" role="alert">
                No items found for this order.
            </div>
        }
    </div>
</div>

<div class="mt-4">
    <a asp-action="UpdateStatus" asp-route-id="@Model.Id" class="btn btn-warning"><i class="fas fa-edit"></i> Update Status</a>
    @if (Model.Status != DAL.Models.OrderStatus.Ready && Model.Status != DAL.Models.OrderStatus.Delivered && Model.Status != DAL.Models.OrderStatus.Cancelled)
    {
        <form asp-action="CancelOrder" asp-route-id="@Model.Id" method="post" class="d-inline ms-2" onsubmit="return confirm('Are you sure you want to cancel this order? This cannot be undone!');">
            @Html.AntiForgeryToken()
            <button type="submit" class="btn btn-danger"><i class="fas fa-times-circle"></i> Cancel Order</button>
        </form>
    }
    <a asp-action="Index" class="btn btn-secondary ms-2"><i class="fas fa-list"></i> Back to Orders List</a>
</div>

@section Scripts {
    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script> @* استبدل بـ Font Awesome CDN أو ملفك المحلي *@
}